PHPrbl

What is it?
In short: a quick and easy tool to keep clients using open proxies away from 
          your site, and so, reducing referrer spam.

How do I use it?
Usage if fairly simple, place the file rbl.php in the document tree of your
website and include the file rbl.php as high as possible in your PHP code:

	require_once('rbl.php');

Try to place this above any other PHP code since PHPrbl generates a HTTP
header, and it doesn't keep an eye on any other headers.

I have used PHPrbl successfully in Mambo (http://www.mamboserver.com) and in 
b2evolution (http://b2evolution.net/). With both packages, the file rbl.php
could be included in the top of the main index.php

Logging to SQL:
If you want to log IP addresses that have been blocked using PHPrbl, you need
to create a table called `blocked` using the following structure:

-- 
-- Table structure for table `blocked`
-- 

DROP TABLE IF EXISTS `blocked`;
CREATE TABLE `blocked` (
  `id` int(8) NOT NULL auto_increment,
  `ip` varchar(15) NOT NULL default '',
  `count` int(8) NOT NULL default '0',
  `lastseen` varchar(11) NOT NULL default '',
  `service` varchar(255) NOT NULL default '',
  `referer` varchar(255) default NULL,
  PRIMARY KEY  (`id`),
  UNIQUE KEY `ip` (`ip`)
) TYPE=MyISAM;

--
-- End table structure
--

Please note that the logging to MySQL has been completely rewritten between
version 0.1 and 0.2, and the structure of the table is totally different,
therefore I chose to add the "DROP TABLE IF EXISTS". This means all previously
gathered data will be lost. This also means that you will need to rewrite any
queries you used to display blocked hosts.

From version 0.3, PHPrbl support prechecking of IP addresses. This will only
work with MySQL enabled. Set $mysql_precheck to 1 in rbl.php to enable this 
feature.
When enabled, the client IP address is checked against the database. Previously
blocked IP addresses will now be blocked before a DNS lookup is done. On really
busy servers this might improve performance.



TODO:
* Find a bigger list of RBL services that list open proxies. SORBS was nice,
  but it also lists dynamic IP ranges. We'd be blocking too big an audience
  if we used it.
